<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Show product</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script type="text/javascript" src="https://code.jquery.com/jquery-1.12.4.min.js" ></script>
    <!-- iamport.payment.js -->
    <script type="text/javascript" src="https://cdn.iamport.kr/js/iamport.payment-1.2.0.js"></script>
</head>
<body>

<h1>Show product</h1>

<div th:if="${not #lists.isEmpty(productFind)}">
    <table>
        <thead>
        <tr>
            <th>productName</th>
            <th>productPrice</th>
<!--            <th>productImage</th>-->
            <th>productStock</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td id="productName" th:text="${productFind.getProductName()}"></td>
            <td id="productPrice" th:text="${productFind.getProductPrice()}"></td>
            <td th:text="${productFind.getProductStock()}"></td>
<!--            <td>-->
<!--                <div th:each="url : ${menu.pictureUrls}">-->
<!--                    <img th:src="${url}" alt="Menu Image" style="max-width: 100px; max-height: 100px;"/>-->
<!--                </div>-->
<!--            </td>-->
        </tr>
        </tbody>
    </table>

    <input type="hidden" id="buyerEmail" th:value="${user.getUserEmail()}" />
    <input type="hidden" id="buyerName" th:value="${user.getUserName()}" />
<!--    <input type="hidden" id="buyerTel" th:value="${user.getUserPhone()}" />-->
<!--    <input type="hidden" id="buyerAddr" th:value="${user.getUserAddress()}" />-->
<!--    <input type="hidden" id="buyerPostcode" th:value="${user.getPostcode()}" />-->

</div>
<div th:if="${#lists.isEmpty(productFind)}">
    <p>No products available.</p>
</div>
<button onclick="requestPay()">결제하기</button>
<script>
    const productName = document.getElementById("productName").textContent;
    const productPrice = document.getElementById("productPrice").textContent;
    const buyerEmail = document.getElementById("buyerEmail").value;
    const buyerName = document.getElementById("buyerName").value;
    const buyerTel = document.getElementById("buyerTel").value;
    const buyerAddr = document.getElementById("buyerAddr").value;
    const buyerPostcode = document.getElementById("buyerPostcode").value;

    const IMP = window.IMP;
    IMP.init("imp66770306");

    function requestPay() {
        IMP.request_pay({
            pg: "kakaopay",
            tid: "8559342fd00616b5ff4b2faaea74ca65",
            pay_method: "card",
            merchant_uid: "ORD20180131-0000011",
            name: productName,
            amount: parseInt(productPrice),
            buyer_email: buyerEmail,
            buyer_name: buyerName,
            buyer_tel: "010-4242-4242",
            buyer_addr: "서울특별시 강남구 신사동",
            buyer_postcode: "01181"
        }, function (rsp) { // callback
            $.ajax({
                type: 'POST',
                url: '/verify/' + rsp.imp_uid
            }).done(function(data) {
                if(rsp.paid_amount === data.response.amount){
                    alert("결제 성공");
                } else {
                    alert("결제 실패");
                }
            });
        });
    }
</script>
</body>
</html>