<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MyTaek1 - Broadcast Form</title>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $("form").submit(function (event) {
                event.preventDefault();
                submitForm();
            });
        });

        function submitForm() {
            const formData = {
                broadcastTitle: $("#broadcastTitle").val(),
                broadcastDescription: $("#broadcastDescription").val(),
                productName: $("#productName").val(),
                productDescription: $("#productDescription").val(),
                productPrice: $("#productPrice").val(),
                productStock: $("#productStock").val()
            };

            $.ajax({
                type: "POST",
                url: "/api/broadcasts",
                contentType: "application/json",
                data: JSON.stringify(formData),
                success: function(response) {
                    console.log(response);
                    window.location.href = "/";
                },
                error: function(error) {
                    console.error(error);
                }
            });
        }
    </script>
</head>
<body>
    <nav class="navbar"></nav>
    <form method="post" action="/api/broadcasts">
        <h2>방송 정보</h2>
        <label for="broadcastTitle">Broadcast Title:</label>
        <input type="text" id="broadcastTitle" name="broadcastTitle" required><br>

        <label for="broadcastDescription">Broadcast Description:</label>
        <textarea id="broadcastDescription" name="broadcastDescription" required></textarea><br>

        <h2>상품 정보</h2>
        <label for="productName">Product Name:</label>
        <input type="text" id="productName" name="productName" required><br>

        <label for="productDescription">Product Description:</label>
        <input type="text" id="productDescription" name="productDescription" required><br>

        <label for="productPrice">Product Price:</label>
        <input type="text" id="productPrice" name="productPrice" required><br>

        <label for="productStock">Product Stock:</label>
        <input type="text" id="productStock" name="productStock" required><br>

        <button type="submit">Submit</button>
    </form>
    <script type="text/javascript">
        function checkCookie(name) {
            const cookies = document.cookie.split(';');

            for (const cookie of cookies) {
                const [cookieName, cookieValue] = cookie.trim().split('=');
                if (cookieName === name) {
                    return true;
                }
            }

            return false;
        }

        window.addEventListener("DOMContentLoaded", () => {
            const isAuthenticated = checkCookie('Authorization');

            const navbar = document.querySelector('.navbar');
            navbar.innerHTML = '';

            const homeLink = document.createElement('a');
            homeLink.href = '/';
            homeLink.textContent = 'Home';
            navbar.appendChild(homeLink);

            if (isAuthenticated) {
                const myPageLink = document.createElement('a');
                myPageLink.href = '/my-page';
                myPageLink.textContent = 'MyPage';
                navbar.appendChild(myPageLink);

                const logoutLink = document.createElement('a');
                logoutLink.textContent = 'Logout';
                logoutLink.addEventListener('click', function () {
                    deleteCookie('Authorization');
                });

                logoutLink.href = '/';
                navbar.appendChild(logoutLink);
            } else {
                const loginLink = document.createElement('a');
                loginLink.href = '/api/user/login-page';
                loginLink.textContent = 'Login';
                navbar.appendChild(loginLink);
            }
        });

        function deleteCookie(name) { document.cookie = name + '=; expires=Thu, 01 Jan 1970 00:00:01 GMT; path=/;'; }
    </script>
</body>
</html>